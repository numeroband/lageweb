webpackJsonp([1],{0:function(t,e,r){t.exports=r("cDNt")},cDNt:function(t,e,r){"use strict";function n(t){return s._17(0,[s._14(402653184,1,{canvasRef:0}),(t()(),s._3(1,0,[[1,0],["vpCanvas",1]],null,1,"canvas",[["height","800"],["style","cursor: none;"],["width","1280"]],null,null,null,null,null)),(t()(),s._16(-1,null,["\n"]))],null,null)}function i(t){return s._17(0,[(t()(),s._3(0,0,null,null,1,"app-viewport",[],null,null,null,n,g)),s._1(1,114688,null,0,v,[s.z],null,null)],function(t,e){t(e,1,0)},null)}function o(t){return s._17(0,[(t()(),s._3(0,0,null,null,1,"app-viewport",[],null,null,null,n,g)),s._1(1,114688,null,0,v,[s.z],null,null)],function(t,e){t(e,1,0)},null)}function a(t){return s._17(0,[(t()(),s._3(0,0,null,null,1,"app-root",[],null,null,null,o,R)),s._1(1,49152,null,0,h,[],null,null)],null,null)}Object.defineProperty(e,"__esModule",{value:!0});var s=r("/oeL"),u={production:!0},c=function(){function t(){}return t}(),h=function(){function t(){this.title="app"}return t}(),l=[""],_=[""],d=function(){function t(t,e,r,n){this.tex=t,this.name=e,this.images=r,this.rect=n,this.state=1}return t.prototype.load=function(t){return this.tex.load(t)},t.prototype.vertices=function(){var t=this,e=this.state<1?[]:this.images[this.state-1];if(!e)return[];var r=[];return Object.keys(e).forEach(function(n){var i=e[n],o=t.tex.vertices(n,i[0],i[1],i[2],i[3],t.rect[0],t.rect[1],t.rect[2],t.rect[3]);r.push.apply(r,o)}),r},t.prototype.render=function(t){var e=this.images[0];if(e){var r=e[this.state];r&&this.tex.render(t,r[0],r[1],r[2],r[3],this.rect[0],this.rect[1],this.rect[2],this.rect[3])}},t}(),f=function(){function t(t,e,r){this.program=t,this.index=e,this.url=r}return t.prototype.loaded=function(t,e){t.bindTexture(t.TEXTURE_2D,this.tex),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.img),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),this.width=this.img.width,this.height=this.img.height,this.img=void 0,e()},t.prototype.load=function(t){var e=this;return this.tex?Promise.resolve():(this.tex=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.tex),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),this.img=new Image,new Promise(function(r,n){e.img.src=e.url,e.img.addEventListener("load",function(){return e.loaded(t,r)})}))},t.prototype.vertices=function(t,e,r,n,i,o,a,s,u,c){void 0===s&&(s=n),void 0===u&&(u=i);var h=t/100,l=2*o/320-1,_=2*(o+s)/320-1,d=2*a/200-1,f=2*(a+u)/200-1,p=e/this.width,E=(e+n)/this.width,m=r/this.height,v=(r+i)/this.height;return[l,-d,h,p,m,this.index,_,-d,h,E,m,this.index,l,-f,h,p,v,this.index,_,-d,h,E,m,this.index,l,-f,h,p,v,this.index,_,-f,h,E,v,this.index]},t.prototype.render=function(t,e,r,n,i,o,a,s,u,c){this.program.setPositions(t,this.vertices(0,e,r,n,i,o,a,s,u,c)),t.drawArrays(t.TRIANGLES,0,6)},t.prototype.bind=function(t){t.bindTexture(t.TEXTURE_2D,this.tex)},t}(),p=function(){function t(t,e,r){this.MAX_TEXTURES=8,this.VERTEX_ELEMENTS=6,this.textures={},this.program=this.initShaderProgram(t,e,r),this.positionLocation=t.getAttribLocation(this.program,"a_position"),this.texcoordLocation=t.getAttribLocation(this.program,"a_texcoord"),this.texindexLocation=t.getAttribLocation(this.program,"a_texindex"),this.positionBuffer=t.createBuffer(),this.texturesLocation=t.getUniformLocation(this.program,"u_textures[0]")}return t.prototype.use=function(t){t.useProgram(this.program);var e=Object.values(this.textures),r=[];e.forEach(function(e){t.activeTexture(t.TEXTURE0+e.index),e.bind(t),r.push(e.index)}),t.uniform1iv(this.texturesLocation,r)},t.prototype.setPositions=function(t,e){t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW);var r=this.VERTEX_ELEMENTS*Float32Array.BYTES_PER_ELEMENT;t.vertexAttribPointer(this.positionLocation,3,t.FLOAT,!1,r,0*Float32Array.BYTES_PER_ELEMENT),t.enableVertexAttribArray(this.positionLocation),t.vertexAttribPointer(this.texcoordLocation,2,t.FLOAT,!1,r,3*Float32Array.BYTES_PER_ELEMENT),t.enableVertexAttribArray(this.texcoordLocation),t.vertexAttribPointer(this.texindexLocation,1,t.FLOAT,!1,r,5*Float32Array.BYTES_PER_ELEMENT),t.enableVertexAttribArray(this.texindexLocation)},t.prototype.texture=function(t){var e=this.textures[t];if(!e){var r=Object.keys(this.textures).length;if(r==this.MAX_TEXTURES)return void console.error("Trying to create more than",r,"textures");e=new f(this,r,"assets/images/"+t+".png"),this.textures[t]=e}return e},t.prototype.loadShader=function(t,e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(n)),t.deleteShader(n),null)},t.prototype.initShaderProgram=function(t,e,r){var n=this.loadShader(t,t.VERTEX_SHADER,e),i=this.loadShader(t,t.FRAGMENT_SHADER,r),o=t.createProgram();return t.attachShader(o,n),t.attachShader(o,i),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?o:(alert("Unable to initialize the shader program: "+t.getProgramInfoLog(o)),null)},t}(),E=Math.floor(10),m=function(){function t(t){this.tex=t,this.x=0,this.y=0,this.frame=0}return t.prototype.load=function(t){return this.tex.load(t)},t.prototype.update=function(t,e){var r=this.tex.width/3;this.x=t-Math.floor(r/2),this.y=e-Math.floor(r/2)},t.prototype.vertices=function(){var t=this.tex.width/3,e=Math.floor(this.frame/E);e=e>2?e-2:0;var r=t*e;return this.frame=(this.frame+1)%(5*E),this.tex.vertices(100,r,0,t,t,this.x,this.y)},t}(),v=function(){function t(t){this.ngZone=t,this.frames=0,this.lastTimestamp=Date.now(),this.mouseX=0,this.mouseY=0}return t.prototype.createObjects=function(t){var e=this,r=this.canvasRef.nativeElement.getContext("webgl");return fetch("assets/jsons/"+t+".json").then(function(t){return t.json()}).then(function(n){var i=e.program.texture(t);e.objs=Object.values(n.objects).map(function(t){var e=t.name,r=t.images,n=t.rect;return new d(i,e,r,n)});var o=n.background,a=o.name,s=o.images,u=o.rect;return e.background=new d(i,a,s,u),Promise.all(e.objs.map(function(t){return t.load(r)}))})},t.prototype.createCursor=function(t){var e=this.program.texture("cursor");return this.cursor=new m(e),this.cursor.load(t)},t.prototype.ngOnInit=function(){var t=this,e=this.canvasRef.nativeElement.getContext("webgl");this.canvasRef.nativeElement.addEventListener("mousemove",function(e){return t.mouseMove(e)}),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.program=new p(e,"\n\nattribute vec3 a_position;\nattribute vec2 a_texcoord;\nattribute float a_texindex;\n\nvarying vec2 v_texcoord;\nvarying float v_texindex;\n\nvoid main() {\n    gl_Position = vec4(a_position, 1.0);\n    v_texcoord = a_texcoord;\n    v_texindex = a_texindex;\n}\n\n","\n\n#define MAX_TEXTURES 8\n\nprecision mediump float;\n\nvarying vec2 v_texcoord;\nvarying float v_texindex;\n\nuniform sampler2D u_textures[MAX_TEXTURES];\n\nvec4 colorFromTextureArray(int idx) {\n  for (int ii = 0; ii < MAX_TEXTURES; ++ii) {\n    if (ii == idx) {\n      return texture2D(u_textures[ii], v_texcoord);\n    }\n  }\n}\n\nvoid main() {\n  gl_FragColor = colorFromTextureArray(int(v_texindex));\n}\n\n"),Promise.all([this.createObjects("Atlantis_09"),this.createCursor(e)]).then(function(){t.running=!0,t.ngZone.runOutsideAngular(function(){return t.render()})})},t.prototype.mouseMove=function(t){var e=t.target.getBoundingClientRect();this.mouseX=Math.floor(320*(t.clientX-e.left-1)/e.width),this.mouseY=Math.floor(200*(t.clientY-e.top-1)/e.height),this.cursor.update(this.mouseX,this.mouseY)},t.prototype.render=function(){var t=this;if(this.running){var e=this.canvasRef.nativeElement.getContext("webgl");e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.program.use(e);var r=this.objs.reduce(function(t,e){return t.concat(e.vertices())},this.background.vertices());r.push.apply(r,this.cursor.vertices()),this.program.setPositions(e,r);var n=r.length/this.program.VERTEX_ELEMENTS;if(e.drawArrays(e.TRIANGLES,0,n),++this.frames%500==0){var i=Date.now();console.log("Frame rate: "+5e5/(i-this.lastTimestamp)+" fps"),this.lastTimestamp=i}requestAnimationFrame(function(){return t.render()})}},t.ctorParameters=function(){return[{type:s.z}]},t}(),x=[_],g=s._0({encapsulation:0,styles:x,data:{}}),T=(s.Y("app-viewport",v,i,{},{},[]),[l]),R=s._0({encapsulation:0,styles:T,data:{}}),A=s.Y("app-root",h,a,{},{},[]),b=r("qbdv"),y=r("fc+i"),L=s.Z(c,[h],function(t){return s._12([s._13(512,s.i,s.W,[[8,[A]],[3,s.i],s.x]),s._13(5120,s.v,s._11,[[3,s.v]]),s._13(4608,b.d,b.c,[s.v]),s._13(4608,s.h,s.h,[]),s._13(5120,s.a,s._4,[]),s._13(5120,s.t,s._9,[]),s._13(5120,s.u,s._10,[]),s._13(4608,y.b,y.s,[b.b]),s._13(6144,s.H,null,[y.b]),s._13(4608,y.e,y.f,[]),s._13(5120,y.c,function(t,e,r,n){return[new y.k(t),new y.o(e),new y.n(r,n)]},[b.b,b.b,b.b,y.e]),s._13(4608,y.d,y.d,[y.c,s.z]),s._13(135680,y.m,y.m,[b.b]),s._13(4608,y.l,y.l,[y.d,y.m]),s._13(6144,s.F,null,[y.l]),s._13(6144,y.p,null,[y.m]),s._13(4608,s.L,s.L,[s.z]),s._13(4608,y.g,y.g,[b.b]),s._13(4608,y.i,y.i,[b.b]),s._13(512,b.a,b.a,[]),s._13(1024,s.l,y.q,[]),s._13(1024,s.b,function(t,e){return[y.r(t,e)]},[[2,y.h],[2,s.y]]),s._13(512,s.c,s.c,[[2,s.b]]),s._13(131584,s._2,s._2,[s.z,s.X,s.r,s.l,s.i,s.c]),s._13(2048,s.e,null,[s._2]),s._13(512,s.d,s.d,[s.e]),s._13(512,y.a,y.a,[[3,y.a]]),s._13(512,c,c,[])])});u.production&&Object(s.R)(),Object(y.j)().bootstrapModuleFactory(L).catch(function(t){return console.log(t)})},gFIY:function(t,e){function r(t){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+t+"'.")})}r.keys=function(){return[]},r.resolve=r,t.exports=r,r.id="gFIY"}},[0]);